@model OCTWEB_NET45.Models.StockTimeListModel
@{
    ViewBag.Title = "Stock Movement Chart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/static/plotly-2.18.2/plotly.min.js"></script>

<div class="container-fluid">
    <!--<div class="form-row">
         Html.Raw(Json.Encode(Model.StockTimeChartData));
     </div>-->
    <div class="form-row">
        <div class="col">
            <div class="btn-group btn-sm shadow-sm border-0 rounded-lg mt-0 mb-3">
                <a href="@Url.Action(actionName: "HBarChart"
                            , controllerName: "FccAssy"
                            )" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-fan"></i> Fcc Assy Graph
                </a>
                <a href="@Url.Action(actionName: "StockMovementChart"
                            , controllerName: "FccAssy"
                            )" class="btn btn-sm btn-outline-secondary active ">
                    <i class="fas fa-bacon"></i> Stock Movement Chart
                </a>
                <a href="@Url.Action(actionName: "ItemList"
                            , controllerName: "StockItems"
                            )" class="btn btn-sm btn-outline-secondary ">
                    <i class="fas fa-list"></i> Stock Item Quantity
                </a>
            </div>
        </div>
    </div>
    <div class="form-row">
        <ul class="nav nav-tabs" id="item_short_name_tab" role="tablist">
            <li class="nav-item">
                <a class="nav-link text-black active" id="blank-tab" data-toggle="tab" href="#blank"
                   onclick="getData('CORE BLANK/DISC','blank_chart')"
                   role="tab" aria-controls="blank" aria-selected="true">Blank</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="shaving-tab" data-toggle="tab" href="#shaving"
                   onclick="getData('Fc Shaving','shaving_chart')"
                   role="tab" aria-controls="shaving" aria-selected="false">Shaving</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="bonderizing-tab" data-toggle="tab" href="#bonderizing"
                   onclick="getData('Fc Bonderizing','bonderizing_chart')"
                   role="tab" aria-controls="bonderizing" aria-selected="false">Bonderizing</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="forging-tab" data-toggle="tab" href="#forging"
                   onclick="getData('Fc Forging','forging_chart')"
                   role="tab" aria-controls="forging" aria-selected="false">Forging</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="fcl-tab" data-toggle="tab" href="#fcl"
                   onclick="getData('Fc L','fcl_chart')"
                   role="tab" aria-controls="fcl" aria-selected="false">Fc L</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="fcl_supplier-tab" data-toggle="tab" href="#fcl_supplier"
                   onclick="getDataSupplier('Fc L(Supplier)','fcl_supplier_chart')"
                   role="tab" aria-controls="fcl_supplier" aria-selected="false">Fc L(Supplier)</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="flange-tab" data-toggle="tab" href="#flange"
                   onclick="getDataAll('FLANGE','flange_chart')"
                   role="tab" aria-controls="flange" aria-selected="false">FLANGE</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="fc_zinc_plating-tab" data-toggle="tab" href="#fc_zinc_plating"
                   onclick="getData('Fc Zinc Plating','fc_zinc_plating_chart')"
                   role="tab" aria-controls="fc_zinc_plating" aria-selected="false">Fc Zinc Plating</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="flange_zinc_plating-tab" data-toggle="tab" href="#flange_zinc_plating"
                   onclick="getData('Flange Zinc Plating','flange_zinc_plating_chart')"
                   role="tab" aria-controls="flange_zinc_plating" aria-selected="false">Flange Zinc Plating</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="fc_assy_wp_zinc_plating-tab" data-toggle="tab" href="#fc_assy_wp_zinc_plating"
                   onclick="getData('Fc Assy WP Zinc Plating','fc_assy_wp_zinc_plating_chart')"
                   role="tab" aria-controls="fc_assy_wp_zinc_plating" aria-selected="false">Fc Assy WP Zinc Plating</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="ac-tab" data-toggle="tab" href="#ac"
                   onclick="getDataAll('Fc Assy AC (No Zinc Plating)','ac_chart')"
                   role="tab" aria-controls="ac" aria-selected="false">AC</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="wp-tab" data-toggle="tab" href="#wp"
                   onclick="getData('Fc Assy WP','wp_chart')"
                   role="tab" aria-controls="wp" aria-selected="false">WP</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="semi-tab" data-toggle="tab" href="#semi"
                   onclick="getData('Fcc Semi Assy','semi_chart')"
                   role="tab" aria-controls="semi" aria-selected="false">Semi</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="casting-tab" data-toggle="tab" href="#casting"
                   onclick="getData('Fcc Casting','casting_chart')"
                   role="tab" aria-controls="casting" aria-selected="false">Casting</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="fcc_assy-tab" data-toggle="tab" href="#fcc_assy"
                   onclick="getData('Fcc Assy','fcc_assy_chart')"
                   role="tab" aria-controls="fcc_assy" aria-selected="false">Fcc Assy</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="coil_winding-tab" data-toggle="tab" href="#coil_winding"
                   onclick="getData('Coil Winding','coil_winding_chart')"
                   role="tab" aria-controls="coil_winding" aria-selected="false">Coil Winding</a>
            </li>
            <li class="nav-item">
                <a class="nav-link " id="magnet_wire-tab" data-toggle="tab" href="#magnet_wire"
                   onclick="getData('MAGNET WIRE','magnet_wire_chart')"
                   role="tab" aria-controls="magnet_wire" aria-selected="false">MAGNET WIRE</a>
            </li>
        </ul>
    </div>
    <div class="form-row">
        <div class="tab-content">
            <div class="tab-pane fade show active" id="blank" role="tabpanel" aria-labelledby="blank-tab">
                <div id="blank_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="shaving" role="tabpanel" aria-labelledby="shaving-tab">
                <div id="shaving_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="bonderizing" role="tabpanel" aria-labelledby="bonderizing-tab">
                <div id="bonderizing_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="forging" role="tabpanel" aria-labelledby="forging-tab">
                <div id="forging_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="fcl" role="tabpanel" aria-labelledby="fcl-tab">
                <div id="fcl_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="fcl_supplier" role="tabpanel" aria-labelledby="fcl_supplier-tab">
                <div id="fcl_supplier_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="flange" role="tabpanel" aria-labelledby="flange-tab">
                <div id="flange_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="fc_zinc_plating" role="tabpanel" aria-labelledby="fc_zinc_plating-tab">
                <div id="fc_zinc_plating_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="flange_zinc_plating" role="tabpanel" aria-labelledby="flange_zinc_plating-tab">
                <div id="flange_zinc_plating_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="fc_assy_wp_zinc_plating" role="tabpanel" aria-labelledby="fc_assy_wp_zinc_plating-tab">
                <div id="fc_assy_wp_zinc_plating_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="ac" role="tabpanel" aria-labelledby="ac-tab">
                <div id="ac_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="wp" role="tabpanel" aria-labelledby="wp-tab">
                <div id="wp_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="semi" role="tabpanel" aria-labelledby="semi-tab">
                <div id="semi_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="casting" role="tabpanel" aria-labelledby="casting-tab">
                <div id="casting_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="fcc_assy" role="tabpanel" aria-labelledby="fcc_assy-tab">
                <div id="fcc_assy_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="coil_winding" role="tabpanel" aria-labelledby="coil_winding-tab">
                <div id="coil_winding_chart" style="width:100%; height:100%"></div>
            </div>
            <div class="tab-pane fade" id="magnet_wire" role="tabpanel" aria-labelledby="magnet_wire-tab">
                <div id="magnet_wire_chart" style="width:100%; height:100%"></div>
            </div>
        </div>
    </div>
    <div class="form-row">
        @Html.HiddenFor(m => m.first_date_str, new { id = "first_date_str" })
    </div>

</div>
<script language="JavaScript">

    document.getElementById("sidemenubar").style.width = "0";
    document.getElementById("main").style.marginLeft = "0";

    $(document).ready(function () {
        var data = @Html.Raw(Json.Encode(Model.StockTimeChartData));

        var stocktime_chart = document.getElementById('blank_chart');
        var first_date_str = document.getElementById('first_date_str').value;

        var layout = {
            autosize: false,
            width: 1500,
            height:500,
            margin: {
                l: 50,
                r: 20,
                t: 70,
                b: 50
            },
            title: {
                text:'CORE BLANK/DISC',
                font: {
                    size: 24
                },
            },
            xaxis: {
                title: {
                    text: 'Transection Date',
                    font: {
                        size: 14,
                        color: '#7f7f7f'
                    }
                },
                //  tickangle: -90,
                //  textangle: -90,
                showticklabels: true,
                tickangle: 'auto',
                tickfont: {
                    // family: 'Old Standard TT, serif',
                    size: 12,
                    color: 'black'
                },
                tickmode: "linear",
                tick0: first_date_str,
                dtick: 7 * 24 * 3600 * 1000
            },
            yaxis: {
                title: {
                    text: 'Cumulative Quantity',
                    font: {
                        // family: 'Courier New, monospace',
                        size: 14,
                        color: '#7f7f7f'
                    }
                },
            }
        };

        var config = {responsive: true}

        Plotly.newPlot(stocktime_chart, data, layout, config);
    });

    function getData(itemShortName,chartName)
    {
        var stocktime_chart = document.getElementById(chartName);
        var itemShortName = itemShortName;
        var first_date_str = document.getElementById('first_date_str').value;

        $.ajax({
            type: "GET",
            url: "/FccAssy/GetDataChart",
            contentType: "application/json; charset=utf-8",
            data: {"itemShortName":itemShortName},
            datatype: "json",
            success: function (data){
                var data = data;
                var layout = {
                    autosize: false,
                    width: 1500,
                    height:500,
                    margin: {
                        l: 50,
                        r: 20,
                        t: 70,
                        b: 50
                    },
                    title: {
                        text: itemShortName,
                        font: {
                            size: 24
                        },
                    },
                    xaxis: {
                        title: {
                            text: 'Transection Date',
                            font: {
                                size: 14,
                                color: '#7f7f7f'
                            }
                        },
                        showticklabels: true,
                        tickangle: 'auto',
                        tickfont: {
                            size: 12,
                            color: 'black'
                        },
                        tickmode: "linear",
                        tick0: first_date_str,
                        dtick: 7 * 24 * 3600 * 1000
                    },
                    yaxis: {
                        title: {
                            text: 'Cumulative Quantity',
                            font: {
                                size: 14,
                                color: '#7f7f7f'
                            }
                        },
                    }
                };
                var config = {responsive: true}

                Plotly.newPlot(stocktime_chart, data, layout, config);
            },
            error: function(){
                alert("Get data for chart load failed.");
            }
        });
    };


    function getDataSupplier(itemShortName,chartName)
    {
        var stocktime_chart = document.getElementById(chartName);
        var itemShortName = itemShortName;
        var first_date_str = document.getElementById('first_date_str').value;

        $.ajax({
            type: "GET",
            url: "/FccAssy/GetDataChartSupplier",
            contentType: "application/json; charset=utf-8",
            data: {"itemShortName":itemShortName},
            datatype: "json",
            success: function (data){
                var data = data;
                var layout = {
                    autosize: false,
                    width: 1500,
                    height:500,
                    margin: {
                        l: 50,
                        r: 20,
                        t: 70,
                        b: 50
                    },
                    title: {
                        text: itemShortName,
                        font: {
                            size: 24
                        },
                    },
                    xaxis: {
                        title: {
                            text: 'Transection Date',
                            font: {
                                size: 14,
                                color: '#7f7f7f'
                            }
                        },
                        showticklabels: true,
                        tickangle: 'auto',
                        tickfont: {
                            size: 12,
                            color: 'black'
                        },
                        tickmode: "linear",
                        tick0: first_date_str,
                        dtick: 7 * 24 * 3600 * 1000
                    },
                    yaxis: {
                        title: {
                            text: 'Cumulative Quantity',
                            font: {
                                size: 14,
                                color: '#7f7f7f'
                            }
                        },
                    }
                };
                var config = {responsive: true}

                Plotly.newPlot(stocktime_chart, data, layout, config);
            },
            error: function(){
                alert("Get data supplier for chart load failed.");
            }
        });
    };

    function getDataAll(itemShortName,chartName)
    {
        var stocktime_chart = document.getElementById(chartName);
        var itemShortName = itemShortName;
        var first_date_str = document.getElementById('first_date_str').value;

        $.ajax({
            type: "GET",
            url: "/FccAssy/GetDataChartAll",
            contentType: "application/json; charset=utf-8",
            data: {"itemShortName":itemShortName},
            datatype: "json",
            success: function (data){
                var data = data;
                var layout = {
                    autosize: false,
                    width: 1500,
                    height:500,
                    margin: {
                        l: 50,
                        r: 20,
                        t: 70,
                        b: 50
                    },
                    title: {
                        text: itemShortName,
                        font: {
                            size: 24
                        },
                    },
                    xaxis: {
                        title: {
                            text: 'Transection Date',
                            font: {
                                size: 14,
                                color: '#7f7f7f'
                            }
                        },
                        showticklabels: true,
                        tickangle: 'auto',
                        tickfont: {
                            size: 12,
                            color: 'black'
                        },
                        tickmode: "linear",
                        tick0: first_date_str,
                        dtick: 7 * 24 * 3600 * 1000
                    },
                    yaxis: {
                        title: {
                            text: 'Cumulative Quantity',
                            font: {
                                size: 14,
                                color: '#7f7f7f'
                            }
                        },
                    }
                };
                var config = {responsive: true}

                Plotly.newPlot(stocktime_chart, data, layout, config);
            },
            error: function(){
                alert("Get data all for chart load failed.");
            }
        });
    };



</script>
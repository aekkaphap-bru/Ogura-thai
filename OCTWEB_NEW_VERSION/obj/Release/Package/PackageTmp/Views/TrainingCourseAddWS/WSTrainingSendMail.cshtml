@model OCTWEB_NET45.Models.WSTrainingSendMailModel
@{
    ViewBag.Title = "WS Training Course Send E-mail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

    #tabledepdata {
        display: none; /* ซ่อนไว้ตั้งแต่เริ่มต้น */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    table.tablecustom {
        table-layout: fixed;
        /*  width: 250px; */
    }


    .popup-container {
        display: none; /* ซ่อนเริ่มต้น */
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* สีดำโปร่งแสง */
        z-index: 1000; /* ให้อยู่เหนือสุด */
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .table-content {
        height: 90%;
        overflow-y: auto;
        overflow-x: hidden;
    }
    /* Popup Content */
    .popup-content {
        background: white;
        padding: 20px;
        height: 70%;
        border-radius: 10px;
        width: 50%;
        max-width: 600px;
        box-shadow: 10px;
        position: relative;
    }



    /*.close-btn {
        font-size: 30px;
        font-weight: bold;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ff4d4d;*/ /* สีแดง */
        /*color: white;
        border-radius: 50%;*/ /* ทำให้เป็นวงกลม */
        /*cursor: pointer;
        right: 15px;
    }*/


    /*Close Button*/
    .close-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 30px;
        font-weight: bold;
        cursor: pointer;
        color: red;
    }
        .close-btn:hover {
            color: darkred;
        }
</style>

<div class="container-fluid">
    <div class="row">
        <a href="/TrainingCourseManagement/SubTrainingCourseManagementList" class="btn-outline-secondary"> <i class="fa fa-angle-left"></i> Training Course Management </a>&nbsp;
        <a href="/TrainingCourseAddWS/WSTrainingList" class="btn-outline-secondary"> <i class="fa fa-angle-left"></i> Training Course [WS] List </a>&nbsp;
    </div>
</div>
<div class="container">
    @using (Html.BeginForm("WSTrainingSendMail", "TrainingCourseAddWS", FormMethod.Post, new { @class = "form-horizontal", role = "form", @id = "Form1" }))
    {
       <div class="form-row justify-content-center">
           <div class="col-md-8 col-sm-12 text-center">
               <h3 class="font-weight-bolder my-1">Send Mail <span style="color:red;">Setup</span></h3>
               <p class="text-success">@ViewBag.Message</p>
           </div>
       </div>
        <div class="form-row justify-content-center">
            @{
                var status_style_foot = "";
                if (Model.WsTrain.Train_Status == 1)
                {
                    status_style_foot = "background: linear-gradient(to right, #ede6d6, #f1ddab, #f4d37f, #f5c951, #f6be00);";
                }
                else if (Model.WsTrain.Train_Status == 0)
                {
                    status_style_foot = "background: linear-gradient(to left, #e42217, #f15244, #f9776d, #fd9a94, #fbbbb9);";
                }
                else
                {
                    status_style_foot = "background: linear-gradient(to right, #ede6d6, #d8d4a0, #b3c570, #7db948, #12ad2b);";
                }
            }
        </div>
        <div class="form-row justify-content-center">
            <div class="col-md-6 col-sm-12">
                <div class="card shadow-lg border-0 rounded-lg mt-0 mb-3">
                    <div class="card-header justify-content-center">
                        @Html.HiddenFor(m => m.WsTrain.Id)
                        @Html.HiddenFor(m => m.WsTrain.Train_NumberWS)
                        @Html.HiddenFor(m => m.WsTrain.Train_Header)
                        @Html.HiddenFor(m => m.WsTrain.Train_HeaderThai)
                        @Html.HiddenFor(m => m.WsTrain.Trai_NameArea)
                        @Html.HiddenFor(m => m.WsTrain.Train_DateWS)
                        @Html.HiddenFor(m => m.WsTrain.Trai_Rev)
                        @Html.HiddenFor(m => m.WsTrain.Train_Status)
                        @Html.HiddenFor(m => m.WsTrain.Train_DateChkSendMail)
                        <p id="emailTo" style="color:black">To:  </p>
                        <p style="color:black">Subject : Update the data working standard </p>
                    </div>
                    <div class="card-body">
                        <div class="form-row justify-content-center">
                            <div class="col">
                                <p id="nameTo" style="color:black">Dear K'</p>
                                <p style="color:black">Please update list name of employee into</p>
                                <p style="color:black">WS Number : @Html.DisplayFor(m => m.WsTrain.Train_NumberWS)</p>
                                <p style="color:black">WS Name : @Html.DisplayFor(m => m.WsTrain.Train_Header)</p>
                                <p style="color:black">Line Name : @Html.DisplayFor(m => m.WsTrain.Trai_NameArea)</p>
                                <p style="color:black">Registration WS Date : @Html.DisplayFor(m => m.WsTrain.Train_DateWS)</p>
                                <br />
                                <p style="color:black">*Please fill out the documents within 7 days. On OCT WEB SYSTEMS</p>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer" style="@status_style_foot">
                        @if (Model.WsTrain.Train_Status == 0)
                        {
                            <p style="color:black">
                                <span class="badge badge-danger badge-pill">
                                    <i class="fa fa-paper-plane" aria-hidden="true"></i> Pending
                                </span> (มีการลงทะเบียนฝึก/อบรมWS)
                            </p>
                        }
                        else if (Model.WsTrain.Train_Status == 1)
                        {
                            <p style="color:black">
                                <span class="badge badge-warning badge-pill">
                                    <i class="fa fa-spinner" aria-hidden="true"></i> In progress
                                </span> (แจ้งอีเมลแล้ว)
                            </p>
                        }
                        else
                        {
                            <p style="color:black">
                                <span class="badge badge-success badge-pill">
                                    <i class="fa fa-check-circle" aria-hidden="true"></i> Complete
                                </span> (อัพโหลดเรียบร้อย)
                            </p>
                        }
                    </div>

                </div>
                <div class="form-row d-flex justify-content-between">
                    <div class="col-auto">
                        <button type="button" id="detaildep" name="detaildep" class="btn">
                            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div class="col-auto">
                        <button type="submit" name="SendEmailWSTrain" value="Send Email" class="btn btn-primary">
                            <i class="fa fa-paper-plane" aria-hidden="true"></i>
                            <span> Send Mail</span>
                        </button>
                    </div>
                </div>

            </div>
            <div class="col-md-6">
                <div class="container-fluid">
                    <div class="form-row">
                        <div class="col">
                            <div class="form-group">
                                <label class="mb-1">Department: </label>
                                @Html.DropDownList("searchDepartmentId", Model.SelectDepartmentId, "All", new { @class = "form-control form-control-sm", style = "width:100%" })
                                <input type="hidden" name="submit_var" id="submit_var" value="">
                            </div>
                        </div>
                    </div>
                    <div>                        
                        <div class="form-row">
                            <table class="tablecustom" id="table1" style="font-size:14px;">
                                <thead>
                                    <tr>
                                        <th width="5%">

                                        </th>
                                        <th width="10%">
                                            Items
                                        </th>
                                        <th width="20%">
                                            Name
                                        </th>
                                        <th width="25%">
                                            Sur Name
                                        </th>
                                        <th width="40%">
                                            E-mail
                                        </th>

                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.UserList.Select((value, i) => new { i, value }))
                                    {
                                        <tr id="@(item.value.USE_Id)">
                                            <td>
                                                <input type="radio" class="selectedItem" name="selectedItem" id="selectedItem" value="@(item.value.USE_Id)" />
                                            </td>
                                            <td>
                                                @(item.i + 1)

                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.value.USE_FName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.value.USE_LName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.value.USE_Email)
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                       
                    </div>
                </div>
            </div>
        </div>
    }
</div> 

<div id="tabledepdata" class="popup-container"> 
    <div class="popup-content">
        <span class="close-btn">&times;</span>
        <p>ชื่อย่อแผนก ชื่อย่อหน่วยงาน ภายในบริษัท กำหนดให้ใช้ตัวอักษร 2 หลัก</p>
        <div class="table-content">
            <table class="table table-bordered">

                <tbody>
                    <tr>
                        <td>ISO Center</td>
                        <td>==></td>
                        <td> IS </td>
                    </tr>
                    <tr>
                        <td>Humen Resource</td>
                        <td>==></td>
                        <td> HR </td>
                    </tr>
                    <tr>
                        <td>Administration</td>
                        <td>==></td>
                        <td> AD </td>
                    </tr>
                    <tr>
                        <td>Safety</td>
                        <td>==></td>
                        <td> SE </td>
                    </tr>
                    <tr>
                        <td>BOI/Purchase</td>
                        <td>==></td>
                        <td> PU </td>
                    </tr>
                    <tr>
                        <td>Information Technology</td>
                        <td>==></td>
                        <td> IT </td>
                    </tr>
                    <tr>
                        <td>Sale Engineer</td>
                        <td>==></td>
                        <td> EN </td>
                    </tr>
                    <tr>
                        <td>Production Control</td>
                        <td>==></td>
                        <td> PC </td>
                    </tr>
                    <tr>
                        <td>Quality Assuarance</td>
                        <td>==></td>
                        <td> QA </td>
                    </tr>
                    <tr>
                        <td>Quality Control</td>
                        <td>==></td>
                        <td> QC </td>
                    </tr>
                    <tr>
                        <td>Rotor Assy</td>
                        <td>==></td>
                        <td> RA </td>
                    </tr>
                    <tr>
                        <td>Process L3,Oven,Sanding,Pre Oven L</td>
                        <td>==></td>
                        <td> L3 </td>
                    </tr>
                    <tr>
                        <td>Process Press</td>
                        <td>==></td>
                        <td> PP </td>
                    </tr>
                    <tr>
                        <td>Process Griding</td>
                        <td>==></td>
                        <td> GS</td>
                    </tr>
                    <tr>
                        <td>Process Late 1</td>
                        <td>==></td>
                        <td> L1 </td>
                    </tr>
                    <tr>
                        <td>Process Late 2</td>
                        <td>==></td>
                        <td> L2 </td>
                    </tr>
                    <tr>
                        <td>Process Broaching</td>
                        <td>==></td>
                        <td> BR </td>
                    </tr>
                    <tr>
                        <td>Assy Fac.1</td>
                        <td>==></td>
                        <td> AB </td>
                    </tr>
                    <tr>
                        <td>Armature Assy</td>
                        <td>==></td>
                        <td> AT </td>
                    </tr>
                    <tr>
                        <td>GKN Semi, GKN Casting  ,GKN Finishing</td>
                        <td>==></td>
                        <td> GN </td>
                    </tr>
                    <tr>
                        <td>FCC Assy (Bobbin Type)</td>
                        <td>==></td>
                        <td> FC </td>
                    </tr>
                    <tr>
                        <td>Coil Assy</td>
                        <td>==></td>
                        <td> CA </td>
                    </tr>
                    <tr>
                        <td>Fcc Finishing (Epoxy Type)</td>
                        <td>==></td>
                        <td> AF </td>
                    </tr>
                    <tr>
                        <td>Semi Assy Fac.2</td>
                        <td>==></td>
                        <td> AS </td>
                    </tr>
                    <tr>
                        <td>Casting Fac.2</td>
                        <td>==></td>
                        <td> AC </td>
                    </tr>
                    <tr>
                        <td>Production Fac.2</td>
                        <td>==></td>
                        <td> P2 </td>
                    </tr>
                    <tr>
                        <!--<td>Micro Clutch</td>
                <td>==></td>
                <td> MC </td>
                </tr>-->
                        <td>Field Rotor Assy</td>
                        <td>==></td>
                        <td> FR </td>
                    </tr>
                </tbody>
            </table>
        </div>      
    </div>
</div>  


<script language="JavaScript">
    document.getElementById("detaildep").addEventListener("click", function () {
        document.getElementById("tabledepdata").style.display = "flex";
    });

    document.querySelector(".close-btn").addEventListener("click", function () {
        document.getElementById("tabledepdata").style.display = "none";
    });

    //// ปิด Popup เมื่อคลิกนอก Content
    //window.onclick = function (event) {
    //    var popup = document.getElementById("tabledepdata");
    //    if (event.target == popup) {
    //        popup.style.display = "none";
    //    }
    //};

    // Listen for click on toggle checkbox
    $('#select-all').click(function (event) {
        if (this.checked) {
            // Iterate each checkbox
            $(':checkbox').each(function () {
                this.checked = true;
            });
        } else {
            $(':checkbox').each(function () {
                this.checked = false;
            });
        }
    });



    $('input:radio[name=selectedItem]').click(function (event) {
        var row = $(this).closest('tr');
        //var status = row.find("input:radio[name=selectedItem]:checked").val();
        var name = row.find("td:eq(2)").html().trim();
        var lname = row.find("td:eq(3)").html().trim();
        var email = row.find("td:eq(4)").html().trim();

        var emailTo = document.getElementById("emailTo");
        var nameTo = document.getElementById("nameTo");
        emailTo.innerHTML = "<h4>To: "+ email+"</h4>";
        nameTo.innerHTML = "<h4>Dear K' " + name + " " + lname+"</h4>";

    });


    $(document).on('select2:open', function (e) {
        const selectId = e.target.id;
        $(".select2-search__field[aria-controls='select2-" + selectId + "-results']").each(function (key, value) {
            value.focus();
        });
    });

    $(document).ready(function () {

        $("#searchDepartmentId").select2({
            placeholder: "All",
            allowClear: true,
            width: 'resolve'
        });

    });

    $("#table1 tbody tr").click(function () {

        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        }
        else {
            $(this).addClass('selected');
        }

    });

    $("#searchDepartmentId").on("change", function () {
        $("#submit_var").val("selected_department");
        document.forms["Form1"].submit();
        if ($('#searchDepartmentId').val()) {

        }
    });

    $(document).ready(function () {
    $("#Form1").submit(function (e) {
        e.preventDefault(); // ป้องกันการ submit ปกติ

        var form = $(this);
        $.ajax({
            type: form.attr('method'),
            url: form.attr('action'),
            data: form.serialize(),
            success: function (response) {
                if (response.success) {
                    Swal.fire({
                        icon: response.icon,      // ใช้ค่าที่ส่งกลับมาจาก server
                        title: response.icon === 'error' ? 'Error' :
                               response.icon === 'info' ? 'Resent' : 'Success',
                        text: response.message,
                        timer: 4000,
                        statusbar: true,
                        showConfirmButton: false
                    }).then(function () {
                        if (response.redirectUrl) {
                            window.location.href = response.redirectUrl;
                        }
                    });
                } else {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Warning',
                        text: response.message,
                        confirmButtonText: 'OK'
                    });
                }
            },
            error: function () {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An error occurred while sending the request.',
                    confirmButtonText: 'OK'
                });
            }
        });
    });
});


</script>



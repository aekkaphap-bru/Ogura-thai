@model OCTWEB_NET45.Models.UserDetailPagedListModel
@using PagedList.Mvc;
@{
    ViewBag.Title = "Add Group Member";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@using (Html.BeginForm("addGroupMember", "UserGroup", FormMethod.Post, new { @class = "form-horizontal", role = "form",id="Form1" }))
{
    <div class="container-fluid">
        <div class="card shadow-lg border-0 rounded-lg mt-0 mb-3">
            <div class="card-header justify-content-center">
                <h3 class="font-weight-bolder my-1 text-center">Add Group Members</h3>
                <p class="text-success">@ViewBag.Message</p>
            </div>
            <div class="card-body">
                <section id="selectedUserForm">
                    <div class="row">
                        <input type="hidden" id="groupid" name="groupid" value=@ViewData["groupid"]>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label>Group Name: </label>
                                <input type="text" value=@ViewData["groupName"] name="groupName" class="form-control form-control-sm" readonly />
                            </div>
                        </div>   
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label>Member: </label>
                                <button type="button" id="formSelectedUserMember" class="btn btn-sm btn-info">
                                    <i class="fas fa-info"></i> Show Member
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="selectdeUserMemberForm" style="display:none;">
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <button type="button" value="Delete" id="deleteall" name="DeleteBtn" class="btn btn-sm btn-danger" >
                                    <i class="fas fa-trash-alt"></i> Delete
                                </button>
                                <input hidden="hidden" id="Delete" name="Delete" value="null" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <table class="tablecustom" style="font-size:14px;">
                                    <thead>
                                        <tr>
                                            <th>
                                                <input type="checkbox" name="select-all" id="select-all" onclick="selectAll(this)" />
                                            </th>
                                            <th>
                                                User Code
                                            </th>
                                            <th>
                                                Nick Name
                                            </th>
                                            <th>
                                                First Name
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in ViewBag.SelectedMembers)
                                        {
                                            <tr>
                                                <td>
                                                    <input type="checkbox" name="selectedToDeleteMember" value="@(item.USE_Id)" />
                                                </td>
                                                <td>
                                                    @item.USE_Usercode
                                                </td>
                                                <td>
                                                    @item.USE_NickName
                                                </td>
                                                <td>
                                                    @item.USE_FName
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div> 
                </section>

            </div>
        </div>
    </div>
            
    <div class="container-fluid">
        <section id="searchUserForm">
            @Html.ValidationSummary(true)
            <fieldset>
                <legend>Enter condition for search users data</legend>
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label>User Name:</label>
                            <input type="text" value=@ViewData["searchFname"] name="searchFname" placeholder="User Name" class="form-control form-control-sm" />
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Nick Name: </label>
                            <input type="text" name="searchNickname" value=@ViewData["searchNickname"] placeholder="Nick Name" class="form-control form-control-sm" />
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label>Department: </label>
                            @Html.DropDownList("searchDep", ViewBag.DepartmentID as SelectList, "Select Department", new { @class = "form-control form-control-sm" })
                        </div>
                    </div>
                    <div class="col align-self-end">
                        <div class="form-group">
                            <button type="submit" value="Search" id="Search" name="Search" class="btn btn-sm btn-success">
                                <i class="fas fa-search"></i> Search
                            </button>
                        </div>
                    </div>
                </div>
                <div class="row">
                   
                </div>
            </fieldset>
        </section>
    </div>
            
 <div class="container-fluid">
        <section id="selectUserForm">
            <div class="row">
                <button type="button" id="addBtn" value="addBtn" name="addBtn" class="btn btn-sm btn-primary" >
                    <i class="fas fa-plus"></i> Add
                </button>
                <input hidden="hidden" id="Add" name="Add" value="null" />

            </div>
           <div class="row">
               <table class="tablecustom" style="font-size:14px;">
                   <thead>
                       <tr>
                           <th>
                               <input type="checkbox" name="select-all-add" id="select-all-add" onclick="selectAllAdd(this)" />
                           </th>
                           <th>
                               Items
                           </th>
                           <th>
                               User Code
                           </th>
                           <th>
                               Nick Name
                           </th>
                           <th>
                               First Name
                           </th>
                           <th>
                               Last Name
                           </th>
                           <th>
                               Dept.
                           </th>
                       </tr>
                   </thead>
                   <tbody>
                       @foreach (var item in Model.UserDetailModelPagedList.Select((value, i) => new { i, value }))
                       {
                           <tr>
                               <td>
                                   <input type="checkbox" name="selectedItem-add" value="@(item.value.USE_Id)" />
                               </td>
                               <td>
                                   @((item.i + 1) + (30 * (Model.UserDetailModelPagedList.PageNumber - 1)))
                               </td>
                               <td>
                                   @Html.DisplayFor(modelItem => item.value.USE_Usercode)
                               </td>
                               <td>
                                   @Html.DisplayFor(modelItem => item.value.USE_NickName)
                               </td>
                               <td>
                                   @Html.DisplayFor(modelItem => item.value.USE_FName)
                               </td>
                               <td>
                                   @Html.DisplayFor(modelItem => item.value.USE_LName)
                               </td>
                               <td>
                                   @Html.DisplayFor(modelItem => item.value.Department_name)
                               </td>
                           </tr>
                       }
                   </tbody>
               </table>
           </div>
        </section>
        <div class="row justify-content-center">
            Page @(Model.UserDetailModelPagedList.PageCount < Model.UserDetailModelPagedList.PageNumber ? 0 : Model.UserDetailModelPagedList.PageNumber) of @Model.UserDetailModelPagedList.PageCount
        </div>
        <div class="row justify-content-center">
            @Html.PagedListPager(Model.UserDetailModelPagedList, page => Url.Action("addGroupMember", new RouteValueDictionary()
            {
                {"Page", page},
                {"Usercode", Model.Usercode},
                {"Fname", Model.Fname},
                {"Nickname",Model.Nickname},
                {"Dep",Model.Dep},
                {"National",Model.National}
            }))
        </div>
         <div class="row justify-content-center">
             <div class="form-group">
                 <button type="button" onclick="history.back()" name="Cancel" class="btn btn-sm btn-outline-primary">
                     <i class="fas fa-undo"></i> Back
                 </button>
             </div>
         </div>
    </div>
        <!--<div class="text-center" id="pagingControl">
                <input type="hidden" id="selectedOption" name="selectedOption" />                
            </div>
            --> 

}


<script language="JavaScript">
    $(document).on('select2:open', function (e) {
        const selectId = e.target.id;
        $(".select2-search__field[aria-controls='select2-" + selectId + "-results']").each(function (key, value) {
            value.focus();
        });
    });
    $(document).ready(function () {
        
        $("#searchDep").select2({
            placeholder: "All",
            allowClear: true,
            width: 'resolve'
        });
        
    });

    $("#Search").click(function () {
        $("#Delete").val("");
        $("#Add").val("");
        $("#Search").val("Search");
        document.forms["Form1"].submit();
    })
    $("#addBtn").click(function () {
        $("#Delete").val("");
        $("#Search").val("");
        $("#Add").val("Add");
        document.forms["Form1"].submit();
    })
    $("#deleteall").click(function () {
        $("#Search").val("");
        $("#Add").val("");
        $("#Delete").val("Delete");
        document.forms["Form1"].submit();
    })
    // Listen for click on toggle checkbox
    /*
    $('#select-all').click(function (event) {
        if (this.checked) {
            // Iterate each checkbox
            $(':checkbox').each(function () {
                this.checked = true;
            });
        } else {
            $(':checkbox').each(function () {
                this.checked = false;
            });
        }
    });
   */

    function selectAll(source) {
        checkboxes = document.getElementsByName('selectedToDeleteMember');
        for (var i = 0, n = checkboxes.length; i < n; i++) {
            checkboxes[i].checked = source.checked;
        }
    }

    function selectAllAdd(source) {
        checkboxes = document.getElementsByName('selectedItem-add');
        for (var i = 0, n = checkboxes.length; i < n; i++) {
            checkboxes[i].checked = source.checked;
        }
    }

    $("#formSelectedUserMember").click(function () {
        $("#selectdeUserMemberForm").toggle();
    });

</script>

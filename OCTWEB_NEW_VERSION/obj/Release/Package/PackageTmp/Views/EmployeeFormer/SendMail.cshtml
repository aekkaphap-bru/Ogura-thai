@model OCTWEB_NET45.Models.EmployeeFormerSendMailModel
@{
    ViewBag.Title = "SendMail";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>
    table.tablecustom {
        table-layout: fixed;
        /*  width: 250px; */
    }
</style>
<div class="row">
    <a href="/EmployeeFormer/EmpList" class="btn-outline-secondary"> <i class="fa fa-angle-left"></i> Former List Setup</a>&nbsp;
</div>
@{
    var status_style_foot = "background: linear-gradient(to right, #ede6d6, #d8d4a0, #b3c570, #7db948, #12ad2b);";
}
@using (Html.BeginForm("SendMail", "EmployeeFormer", FormMethod.Post, new { @class = "form-horizontal", role = "form", @id = "Form1" }))
{
    <div class="row">
        <div class="col">
            <div class="text-center">
                <h4 class="font-weight-bolder my-1 text-center">Send Mail <span style="color:red;">Setup</span></h4>
                <p class="text-success">@ViewBag.Message</p>
            </div>
        </div>

    </div>
    <div class="row">
        <div class="col">
            <div class="row">
                <div class="container-sm">
                    <div class="card shadow-lg border-0 rounded-lg mt-0 mb-3">
                        <div class="card-header justify-content-center">
                            
                            <p id="emailTo" style="color:black">To:  </p>
                            <p style="color:black">Subject : Remove Account </p>
                            
                        </div>
                        <div class="card-body">
                            <div class="form-row justify-content-center">
                                <div class="col">
                                    <p id="nameTo" style="color:black">Dear K'</p>
                                    <p style="color:black">
                                        เนื่องจาก มีพนักงานลาออก ขอให้ทางหัวหน้าแผนก (Advisor / Head department) 
                                    ,ทำเอกสารแจ้ง ขอยกเลิกบัญชีผู้ใช้ที่ลาออกแล้ว ส่งให้ทางแผนก IT ดำเนินการด้วยค่ะ
                                    </p>
                                    <p style="color:black">**Form remove account (เอกสารสำหรับยกเลิกบัญชี)</p>
                                    <p style="color:black">OCT-IT-FM018 REMOVE USER ACCOUNT (All Account login) -> OCT-IT-FM018)</p>
                                    <br/>
                                    <p style="color:black">*Do Not Reply This E-Mail!</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer" style="@status_style_foot">
                            <p style="color:black"><span class="badge badge-success badge-pill"></span></p>
                        </div>

                    </div>
                </div>
            </div>
            <div class="row justify-content-end">
                <div class="container text-right">
                    <button type="submit" id="SendEmail" name="SendEmail" value="Send Email" class="btn btn-primary" >
                        <i class="fa fa-paper-plane" aria-hidden="true"></i>
                        <span> Send Mail</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="container-fluid">
                <div class="row">
                    <div class="form-group">
                        <label class="mb-1">Department: </label>
                        @Html.DropDownList("searchDepartmentId", Model.SelectDepartmentId, "All")
                        <input type="hidden" name="submit_var" id="submit_var" value="">
                    </div>
                </div>
                <div class="row">
                    <table class="tablecustom " id="table1" style="font-size:14px;">
                        <thead>
                            <tr>
                                <th width="5%">

                                </th>
                                <th width="10%">
                                    Items
                                </th>
                                <th width="20%">
                                    Name
                                </th>
                                <th width="25%">
                                    Sur Name
                                </th>
                                <th width="40%">
                                    E-mail
                                </th>

                            </tr>
                        </thead>
                        <tbody id="ttbody">
                            <!--foreach (var item in Model.UserList.Select((value, i) => new { i, value }))
                            {
                                <tr id="(item.value.USE_Id)">
                                    <td>
                                        <input type="radio" class="selectedItem" name="selectedItem" id="selectedItem" value="(item.value.USE_Id)" />
                                    </td>
                                    <td>
                                        (item.i + 1)

                                    </td>
                                    <td>
                                        Html.DisplayFor(modelItem => item.value.USE_FName)
                                    </td>
                                    <td>
                                        Html.DisplayFor(modelItem => item.value.USE_LName)
                                    </td>
                                    <td>
                                        Html.DisplayFor(modelItem => item.value.USE_Email)
                                    </td>
                                </tr>
                            }-->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

}


<script language="JavaScript">
    // Listen for click on toggle checkbox
    $('#select-all').click(function (event) {
        if (this.checked) {
            // Iterate each checkbox
            $(':checkbox').each(function () {
                this.checked = true;
            });
        } else {
            $(':checkbox').each(function () {
                this.checked = false;
            });
        }
    });

    $('input[type="radio"]').closest('tr').on('click', function () {
        alert(123);
        var row = $(this).closest('tr');
        //var status = row.find("input:radio[name=selectedItem]:checked").val();
        var name = row.find("td:eq(2)").html().trim();
        var lname = row.find("td:eq(3)").html().trim();
        var email = row.find("td:eq(4)").html().trim();

        var emailTo = document.getElementById("emailTo");
        var nameTo = document.getElementById("nameTo");
        emailTo.innerHTML = "<h4>To: " + email + "</h4>";
        nameTo.innerHTML = "<h4>Dear K' " + name + " " + lname + "</h4>";


        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        }
        else {
            $(this).addClass('selected');
        }
    });



  

    $(document).on('select2:open', function (e) {
        const selectId = e.target.id;
        $(".select2-search__field[aria-controls='select2-" + selectId + "-results']").each(function (key, value) {
            value.focus();
        });
    });

    $(document).ready(function () {

        $("#searchDepartmentId").select2({
            placeholder: "All",
            allowClear: true,
            width: 'resolve'
        });

    });

    $('#table1 #ttbody').on('click', 'tr', function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        }
        else {
            $(this).addClass('selected');
        }
    });

    $('#table1').click(function () {
        /*
        var row = $(this).closest('tr');
        //var status = row.find("input:radio[name=selectedItem]:checked").val();
        var name = row.find("td:eq(2)").html().trim();
        var lname = row.find("td:eq(3)").html().trim();
        var email = row.find("td:eq(4)").html().trim();

        var emailTo = document.getElementById("emailTo");
        var nameTo = document.getElementById("nameTo");
        emailTo.innerHTML = "<h4>To: " + email + "</h4>";
        nameTo.innerHTML = "<h4>Dear K' " + name + " " + lname + "</h4>";
        */

        var se = document.getElementById("emailTo");
        var emailTo = document.getElementById("emailTo");
        var nameTo = document.getElementById("nameTo");

        var name = " ";
        var lname = " ";
        var email = " ";
        var grid = document.getElementById("table1");
        var checkBoxes = grid.getElementsByClassName("selectedItem");
        for (var i = 0; i < checkBoxes.length; i++) {
            if (checkBoxes[i].checked) {
                var row = checkBoxes[i].parentNode.parentNode;
                var col2 = row.cells[2];
                var col3 = row.cells[3];
                var col4 = row.cells[4];
                name = col2.innerText;
                lname = col3.innerText;
                email = col4.innerText;
            }
        }
        emailTo.innerHTML = "<h4>To: " + email + "</h4>";
        nameTo.innerHTML = "<h4>Dear K' " + name + " " + lname + "</h4>";

    });
   
    /*
    $("#searchDepartmentId").on("change", function () {
        if ($('#searchDepartmentId').val()) {
            $("#submit_var").val("selected_department");
            document.forms["Form1"].submit();
        }
    });
    */

   

    /*
    function loadData() {
        $.ajax({
            url: "/EmployeeFormer/GetUser",
            type: "GET",
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (result) {
                var html = '';
                $.each(result, function (key, item) {
                    html += '<tr>';
                    html += "<td> <input type='radio' class='selectedItem' name='selectedItem' id='selectedItem' value='"+ item.id +"' /> </td>";
                    html += ' <td>' + item.id + '</td>';
                    html += '<td>' + item.fname + '</td>';
                    html += '<td>' + item.lname + '</td>';
                    html += '<td>' + item.email + '</td>';
                    html += '</tr>';
                });
                $('.tbody').html(html);
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }
    */
    $(function () {
        AjaxCall('/EmployeeFormer/GetUser', null).done(function (response) {
            if (response.length > 0) {
                var html = '';
                for (var i = 0; i < response.length; i++) {
                    html += "<tr id='" + response[i].id + "'>";
                    html += "<td> <input type='radio' class='selectedItem' name='selectedItem' id='selectedItem' value='" + response[i].id + "' /> </td>";
                    html += '<td>' + (i+1) + '</td>';
                    html += '<td>' + response[i].fname + '</td>';
                    html += '<td>' + response[i].lname + '</td>';
                    html += '<td>' + response[i].email + '</td>';
                    html += '</tr>';
                }
                $('#ttbody').html(html);
            }
        }).fail(function (error) {
            alert(error.StatusText);
        });

        $('#searchDepartmentId').on("change", function () {
            var dept_id = $('#searchDepartmentId').val();
            var obj = { dept_id: dept_id };
            AjaxCall('/EmployeeFormer/GetUser', JSON.stringify(obj), 'POST').done(function (response) {
                 if (response.length > 0) {
                     var html = '';
                     for (var i = 0; i < response.length; i++) {
                         html += "<tr class='ttr' id='" + response[i].id  + "'>";
                         html += "<td> <input type='radio' class='selectedItem' name='selectedItem' id='selectedItem' value='" + response[i].id + "' /> </td>";
                         html += '<td>' + (i+1) + '</td>';
                         html += '<td>' + response[i].fname + '</td>';
                         html += '<td>' + response[i].lname + '</td>';
                         html += '<td>' + response[i].email + '</td>';
                         html += '</tr>';
                     }
                     $('#ttbody').html(html);
                 }
                 else {
                     $('#ttbody').html('');
                 }
            }).fail(function (error) {
                //alert(error.StatusText);
            });
        });

    });
    function AjaxCall(url, data, type) {
        return $.ajax({
            url: url,
            type: type ? type : 'GET',
            data: data,
            contentType: 'application/json'
        });
    }

   

   

</script>



@model OCTWEB_NET45.Models.UserDetailPagedListModel
@using PagedList.Mvc;
@{
    ViewBag.Title = "UserDetail List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="container">
    <div class="row justify-content-center">
        <div class="col">
            <h3 class="font-weight-bolder my-1 text-center">User Detail <span style="color:red;">Set</span></h3>
            <p class="text-success">@ViewBag.Message</p>      
        </div>
    </div>
    <div class="row">
        <div class="col">
            @using (Html.BeginForm("userDetailList", "UserDetail", FormMethod.Post, new { @class = "form-horizontal", role = "form", id = "Form1" }))
            {
                <fieldset id="formSearch">
                    <legend>Enter condition for search user detail data</legend>
                    <div class="form-row justify-content-center">
                        <div class="col">
                            <p class="text-danger">@Html.ValidationSummary(true)</p>
                        </div>
                    </div>
                    <div class="form-row justify-content-center">
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="mb-1">User Code: </label>
                                <!--<input type="text" value=ViewData["searchUsercode"] name="searchUsercode" class="form-control" aria-label="small" placeholder="User Code" />-->
                                @Html.TextBoxFor(x => x.Usercode, new { placeholder = "", @class = "form-control form-control-sm" ,style="width:100%"})
                                <p class="text-danger">@Html.ValidationMessageFor(m => m.Usercode)</p>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="mb-1">User Name: </label>
                                <!--<input type="text" value=ViewData["searchFname"] name="searchFname" class="form-control" aria-label="small" placeholder="User Name" />-->
                                @Html.TextBoxFor(x => x.Fname, new { placeholder = "", @class = "form-control form-control-sm", style = "width:100%" })
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="mb-1">Nick Name: </label>
                                <!--<input type="text" name="searchNickname" value=ViewData["searchNickname"] class="form-control" aria-label="small" placeholder="Nick Name" />-->
                                @Html.TextBoxFor(x => x.Nickname, new { placeholder = "", @class = "form-control form-control-sm", style = "width:100%" })
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="mb-1">Department: </label>
                                @Html.DropDownList("Dep", Model.Departments, "All", new { @class = "form-control form-control-sm", style = "width:100%" })
                                <!--Html.DropDownList("searchDep", ViewBag.DepartmentID as SelectList, "Select Department", new { class = "form-control" })-->
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="mb-1">Nationality: </label>
                                <!--Html.DropDownList("searchNational", new SelectList(Enum.GetValues(typeof(OCTWEB_NET45.Models.UserDetailModel.Nationality)))
                          , "Select Nationality", new { class = "form-control" })-->
                                @Html.DropDownList("National", Model.Nationals, "All", new { @class = "form-control form-control-sm", style = "width:100%" })
                            </div>
                        </div>
                        <div class="col-md-2 align-self-end ">
                            <div class="form-group ">
                                <button type="submit" value="Search" class="btn btn-sm btn-success ">
                                    <i class="fas fa-search"></i> Search
                                </button>
                            </div>
                        </div>
                    </div>
                </fieldset>
            }

        </div>
    </div>
</div>

<div class="container-fluid">
    @using (Html.BeginForm("DeleteUserUserDetail", "UserDetail", FormMethod.Post, new { @class = "form-horizontal", role = "form", id="Form2" }))
    {
      
    <div class="row">
        <div>

            <a href="@Url.Action(actionName: "Register", controllerName: "Account")" class="btn btn-sm btn-primary" >
                <i class="fas fa-plus"></i> Create New
            </a>
            
            <button type="button" id="deleteall" name="deleteall" value="Delete" class="btn btn-sm btn-danger">
                <i class="fas fa-trash-alt"></i> Delete
            </button> 

        </div>
    </div>
    <div class="row">
        <table class="tablecustom table-sm" id="table1" style="font-size: 14px;">
            <thead>
                <tr>
                    <th>
                        <input type="checkbox" name="select-all" id="select-all" />
                    </th>
                    <th>
                        Edit
                    </th>
                    <th>
                        Items
                    </th>
                    <th>
                        User Code
                    </th>
                    <th>
                        Nick Name
                    </th>
                    <th>
                        First Name
                    </th>
                    <th>
                        Last Name
                    </th>
                    <th>
                        Dept.
                    </th>
                    <th>
                        Tel.
                    </th>
                    <th>
                        E-mail
                    </th>
                    <th>
                        Right
                    </th>
                    <th>
                        Status
                    </th>
                    <th>
                        Nationality
                    </th>

                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.UserDetailModelPagedList.Select((value, i) => new { i, value }))
                {
                    <tr>
                        <td>
                            <input type="checkbox" name="selectedItem" value="@(item.value.USE_Id)" />

                        </td>
                        <td>
                            <a href="@Url.Action(actionName: "getUserDetail"
                            , controllerName: "UserDetail"
                            , routeValues: new {id= item.value.USE_Id })" class="btn btn-sm btn-success">
                                <i class="fas fa-edit"></i> Edit
                            </a>

                        </td>
                        <td>
                            @((item.i + 1) + (30 * (Model.UserDetailModelPagedList.PageNumber - 1)))

                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.value.USE_Usercode)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.value.USE_NickName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.value.USE_FName)
                        </td>

                        <td>
                            @Html.DisplayFor(modelItem => item.value.USE_LName)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.value.Department_name)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.value.USE_TelNo)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.value.USE_Email)
                        </td>
                        <td>
                        
                            <a href="@Url.Action(actionName: "SetPermission"
                            , controllerName: "Permissions"
                            , routeValues: new {id= item.value.USE_Id })" class="btn btn-sm btn-info">
                                <i class="fas fa-tools"></i> Set Right
                            </a>
                        </td>
                        <td>

                            @if (item.value.USE_Status == 1)
                            {
                                <span>Enable</span>
                            }
                            else
                            {
                                <span>Disable</span>
                            }
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.value.USE_Nationality)
                        </td>

                    </tr>
                }
            </tbody>
        </table>
    </div>
    }
    <div class="row justify-content-center">
        <!--<div class="text-center" id="pagingControl">
            <input type="hidden" id="selectedOption" name="selectedOption" />  
        </div>-->
        Page @(Model.UserDetailModelPagedList.PageCount < Model.UserDetailModelPagedList.PageNumber ? 0 : Model.UserDetailModelPagedList.PageNumber) of @Model.UserDetailModelPagedList.PageCount
    </div>
    <div class="row justify-content-center"> 
        @Html.PagedListPager(Model.UserDetailModelPagedList, page => Url.Action("userDetailList", new RouteValueDictionary()
        {
            {"Page", page},
            {"Usercode", Model.Usercode},
            {"Fname", Model.Fname},
            {"Nickname",Model.Nickname},
            {"Dep",Model.Dep},
            {"National",Model.National}

        }))
    </div>
</div>


<script language="JavaScript">
    $(document).on('select2:open', function (e) {
        const selectId = e.target.id;
        $(".select2-search__field[aria-controls='select2-" + selectId + "-results']").each(function (key, value) {
            value.focus();
        });
    });

    // Listen for click on toggle checkbox
    $('#select-all').click(function (event) {
        if (this.checked) {
            // Iterate each checkbox
            $(':checkbox').each(function () {
                this.checked = true;
            });
        } else {
            $(':checkbox').each(function () {
                this.checked = false;
            });
        }
    });

    $("#table1 tbody tr").click(function () {

        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        }
        else {
            $(this).addClass('selected');
        }

    });

    $("#deleteall").click(function () {
        $("#ExportToCsv").val("");
        if (confirm('Delete all selected elements?')) {
            document.forms["Form2"].submit();
        }
    })

    /*
    $('#pagingControl').find('a[href]').on('click', function (e) {
        e.preventDefault();
        $("#selectedOption").val("formPagedList"); // When you submit, you can read this field on the controller and pass it on
        var page = utilities.getQueryStringValue(this, 0).replace('page=', '');
        $('#formSearch').submit();

    });
    */
    $(document).ready(function () {
        /*
        $("#Dep").select2({
            placeholder: "All",
            allowClear: true,
            width: 'resolve'
        });
        $("#National").select2({
            placeholder: "All",
            allowClear: true,
            width: 'resolve'
        });*/
    });
</script>





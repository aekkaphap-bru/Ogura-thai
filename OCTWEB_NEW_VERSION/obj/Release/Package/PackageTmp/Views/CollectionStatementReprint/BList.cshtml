@model OCTWEB_NET45.Models.BillReprintModel
@{
    ViewBag.Title = "Collection Statement Results";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="form-row">
        <div class="col">
            <div class="btn-group btn-sm shadow-sm border-0 rounded-lg mt-0 mb-3">
                <a href="@Url.Action(actionName: "Setup"
                            , controllerName: "BankAccount"
                            )" class="btn btn-sm btn-outline-secondary ">
                    <i class="fas fa-cog"></i> Setup
                </a>
                <a href="@Url.Action(actionName: "BList"
                            , controllerName: "BillingNote"
                            )" class="btn btn-sm btn-secondary ">
                    <i class="fas fa-print"></i> Billing Note
                </a>
                <a href="@Url.Action(actionName: "BList"
                            , controllerName: "BillingNoteReprint"
                            )" class="btn btn-sm btn-secondary ">
                    <i class="fas fa-list"></i> Results
                </a>
                <a href="@Url.Action(actionName: "BList"
                            , controllerName: "CollectionStatement"
                            )" class="btn btn-sm btn-warning ">
                    <i class="fas fa-print"></i> Collection Statement
                </a>
                <a href="@Url.Action(actionName: "BList"
                            , controllerName: "CollectionStatementReprint"
                            )" class="btn btn-sm btn-warning active">
                    <i class="fas fa-list"></i> Results
                </a>

            </div>
        </div>
    </div>
    @using (Html.BeginForm("BList", "CollectionStatementReprint", FormMethod.Post, new { @class = "form-horizontal", role = "form", @id = "Form1" }))
    {
        <div class="form-row">
            <div class="col-md-12 align-self-center">
                <h4 class="font-weight-bolder my-1 text-center">Collection Statement <span style="color:green;">Results</span></h4>
            </div>
        </div>
        <div class="form-row">
            <div class="col">
                <p class="text-success">@ViewBag.Message</p>
                @Html.ValidationSummary(true)
            </div>
        </div>
        <div class="form-row">
            <div class="col">
                <fieldset>
                    <legend>Enter condition for search data</legend>

                    <div class="form-row ">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="mb-0">Customer: </label>
                                @Html.DropDownList("customerCode", Model.SelectCustomerName, "Select", new { style = "width:100%", @class = "form-control form-control-sm" })
                                @Html.ValidationMessageFor(m => m.customerCode, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                @{
                                    string fromdate_str = Model.fromDate.HasValue ? Model.fromDate.Value.ToString("yyyy-MM-dd") : "";
                                }
                                <label class="mb-0">From date: </label>
                                <input type="date" name="fromDate" class="form-control form-control-sm date" value="@fromdate_str" />
                                @Html.ValidationMessageFor(m => m.fromDate, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                @{
                                    string todate_str = Model.toDate.HasValue ? Model.toDate.Value.ToString("yyyy-MM-dd") : "";
                                }
                                <label class="mb-0">To date: </label>
                                <input type="date" name="toDate" class="form-control form-control-sm date" value="@todate_str" />
                                @Html.ValidationMessageFor(m => m.toDate, "", new { @class = "text-danger" })
                            </div>
                        </div>
                        <div class="col-md-5 align-self-end">
                            <div class="form-group">
                                <button type="button" id="SearchBtn" name="SearchBtn" class="btn btn-sm btn-success" value="Search">
                                    <i class="fas fa-search"></i> Search
                                </button>
                                <input hidden="hidden" id="SearchData" name="SearchData" value="null" />

                                <button type="button" id="ExportCSVBtn" name="ExportCSVBtn" class="btn btn-sm btn-info">
                                    <i class="fa fa-download"></i> Export CSV
                                </button>
                                <input hidden="hidden" id="ExportCSV" name="ExportCSV" value="null" />

                                <button id="clear" type="button" name="clear" class="btn btn-sm btn-outline-dark">
                                    <i class="fas fa-eraser"></i> Clear
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-row justify-content-center">
                        <div class="col-md-6">
                            <div class="form-group">
                                <!-- <button type="button" id="ExportToExcelBtn" name="ExportToExcelBtn" class="btn btn-sm btn-outline-info">
                                         <i class="fas fa-print"></i> Export Excel
                                 </button>

                                 <input hidden="hidden" id="ExportToExcel" name="ExportToExcel" value="null" />
                                    -->
                            </div>
                        </div>

                    </div>
                </fieldset>
            </div>
        </div>
        <div class="form-row">
            <table class="tablecustom" id="table1" style="font-size:14px;">
                <thead>
                    <tr>
                        <th>Items</th>
                        <th>Date</th>
                        <th>Document No.</th>
                        <th>Customer Code</th>
                        <th>Customer Name</th>
                        <th>Amount</th>
                        <th>Vat 7%</th>
                        <th>Total</th>
                        <th>Due Date</th>
                        <th>Reprint</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.BillReprintList.Select((value, i) => new { i, value }))
                    {
                        <tr>
                            <td>
                                @(item.i + 1)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.value.HeaderDate_str)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.value.BillNo)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.value.CustomerCode)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.value.CustomerName)
                            </td>
                            <td class="text-right">
                                @Html.DisplayFor(modelItem => item.value.Amount_str)
                            </td>
                            <td class="text-right">
                                @Html.DisplayFor(modelItem => item.value.Vat_str)
                            </td>
                            <td class="text-right">
                                @Html.DisplayFor(modelItem => item.value.Total_str)
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.value.DueDate_str)
                            </td>
                            <td>
                                <a href="@Url.Action(actionName: "BReprint"
                                    , controllerName: "CollectionStatementReprint"
                                    , routeValues: new { bill_no = item.value.BillNo, customer_code = item.value.CustomerCode })"
                                   class="btn btn-sm btn-primary">
                                    <i class="fas fa-print"></i> Reprint
                                </a>

                            </td>
                            <td>
                                <a href="@Url.Action(actionName: "DeleteBill"
                                            , controllerName: "CollectionStatementReprint"
                                            , routeValues: new {bill_no = item.value.BillNo, customer_code= item.value.CustomerCode})"
                                   class="btn btn-sm btn-danger"
                                   onclick="return confirm('Are you sure to delete this bill?');">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

<script language="JavaScript">

    // Listen for click on toggle checkbox
    $('#select-all').click(function (event) {
        if (this.checked) {
            // Iterate each checkbox
            $(':checkbox').each(function () {
                this.checked = true;
            });
        } else {
            $(':checkbox').each(function () {
                this.checked = false;
            });
        }
    });

    $("#table1 tbody tr").click(function () {
        if ($(this).hasClass('selected')) {
            $(this).removeClass('selected');
        }
        else {
            $(this).addClass('selected');
        }
    });

    $(document).ready(function () {
        $("#customerCode").select2({
            placeholder: "Select",
            allowClear: true,
            width: 'resolve'
        });
    })

    $(document).on('select2:open', function (e) {
        const selectId = e.target.id;
        $(".select2-search__field[aria-controls='select2-" + selectId + "-results']").each(function (key, value) {
            value.focus();
        });
    });

    $("#clear").click(function () {
        $('#customerCode').val(null).trigger('change');

        $("input[type=date]").val("");

    });


    $("#SearchBtn").click(function () {
        $("#PrintData").val("");
        $("#ExportCSV").val("");
        document.forms["Form1"].submit();
    })

    $("#PrintBtn").click(function () {
        $("#PrintData").val("PrintData");
        $("#ExportCSV").val("");
        document.forms["Form1"].submit();
    })

    $("#ExportCSVBtn").click(function () {
        $("#ExportCSV").val("ExportCSV");
        $("#PrintData").val("");
        document.forms["Form1"].submit();
    })



</script>